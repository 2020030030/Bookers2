<main>
<%= flash[:danger] %>

 <%= render'books/list',user: @user,book: @book_new%>
 <div class='col-md-8 offset-md-1'>
   <h2>Book detail</h2>
   <table class='table table-hover table-inverse'>


 <thead>
  <th></th>
  <th>Title</th>
  <th>Opinion</th>
  <th colspan="3"></th>
 </thead>


   <tr>
    <td><%= attachment_image_tag @user, :profile_image, fallback: "no_image.jpg",size:"40x40" %></br>
    <%= link_to @user.name, user_path(@book.user) %></td>
    <td><%= @book.title %></td>
    <td><%= @book.body %></td>

      <% if @book.favorited_by?(current_user) %>
    <td>
      <%= link_to book_favorites_path(@book), method: :delete do %>
        ♥<%= @book.favorites.count %>
      <% end %>
    </td>
    <% else %>
    <td>
      <%= link_to book_favorites_path(@book), method: :post do %>
        ♡<%= @book.favorites.count %>
      <% end %>
    <% end %>

    <% if @user.id == current_user.id %>
    <td><%= link_to 'Edit', edit_book_path, class: "btn btn-secondary" %></td>
    <td><%= link_to 'Destroy', book_path,method: :delete ,class: "btn btn-secondary" %></td>
    <% end %>
    <th colspan="3"></th>


    <% @book.book_comments.each do |book_comment| %>
    <% book_comment_user = book_comment.user %>
    <tr>
     <td>
    		<%= link_to user_path(book_comment_user), class: "user_#{book_comment_user.id}" do %>
      		<%= attachment_image_tag book_comment_user, :profile_image, :fill, 50, 50, fallback: "no_image.jpg", size: "50x50" %><br>
      		<%= book_comment_user.name %>
    		<% end %>
    	</td>
    	<td><%= book_comment.comment %></td>
    	<% if current_user == book_comment_user %>
      	<td><%= link_to 'Destroy', book_book_comment_path(book_comment.book_id, book_comment.id), class: 'btn-sm btn-danger', method: :delete %></td>


  <% end %>
     </tr>
    <% end %>
 </table>

 <td>
<%= form_with(model:[@book, @book_comment], local: true) do |f| %>
  <%= f.text_area :comment, rows:'5',placeholder: "コメントをここに" %>
  <%= f.submit "送信" %>
<% end %>
</td>
   </tr>


 </table>

 </div>

</main>